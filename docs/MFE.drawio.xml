<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.3.1" pages="4">
  <diagram name="1. High-Level Architecture" id="t51Tb9-lupZrFwZ3E1QJ">
    <mxGraphModel dx="1036" dy="682" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-1" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#1a1a1a;" value="MFE Module Federation - High-Level Architecture" vertex="1">
          <mxGeometry height="50" width="800" x="400" y="30" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-2" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#666666;" value="Monorepo: Turborepo + pnpm | Module Federation: @module-federation/vite" vertex="1">
          <mxGeometry height="30" width="800" x="400" y="80" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-3" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=16;fontStyle=1;verticalAlign=top;align=center;" value="User Browser" vertex="1">
          <mxGeometry height="210" width="1420" x="100" y="140" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-4" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1;verticalAlign=top;" value="Admin Shell&#xa;(Next.js 15 + React 19)&#xa;Port: 3001&#xa;&#xa;• Admin Dashboard&#xa;• RBAC&#xa;• Module Federation Loader&#xa;• NextAuth.js" vertex="1">
          <mxGeometry height="140" width="300" x="150" y="180" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-5" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1;verticalAlign=top;" value="Web Shell&#xa;(Next.js 15 + React 19)&#xa;Port: 3000&#xa;&#xa;• Public Web&#xa;• Basic Auth&#xa;• Simpler Architecture" vertex="1">
          <mxGeometry height="140" width="300" x="500" y="178" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-6" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;verticalAlign=top;" value="Products Remote&#xa;(Vite 6 + React 19)&#xa;Port: 3529&#xa;&#xa;• Products Management&#xa;• Module Federation" vertex="1">
          <mxGeometry height="140" width="300" x="850" y="180" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-7" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;verticalAlign=top;" value="Users Remote&#xa;(Vite 6 + React 19)&#xa;Port: 6517&#xa;&#xa;• Users Management&#xa;• Module Federation" vertex="1">
          <mxGeometry height="140" width="300" x="1200" y="180" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-9" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#82b366;" value="Runtime&#xa;Module&#xa;Federation" vertex="1">
          <mxGeometry height="40" width="100" x="500" y="225" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-11" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=16;fontStyle=1;verticalAlign=top;" value="Shared Packages (Workspace)" vertex="1">
          <mxGeometry height="220" width="1420" x="100" y="400" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-12" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/auth-core&#xa;&#xa;• Auth Client&#xa;• Shell Store&#xa;• Types" vertex="1">
          <mxGeometry height="140" width="160" x="150" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-13" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/auth-next&#xa;&#xa;• authOptions&#xa;• Callbacks&#xa;• NextAuth.js v5" vertex="1">
          <mxGeometry height="140" width="160" x="330" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-14" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/rbac&#xa;&#xa;• Permissions&#xa;• canWithPermissions&#xa;• Role Checking" vertex="1">
          <mxGeometry height="140" width="160" x="510" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-15" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/stores&#xa;&#xa;• Shell Store&#xa;• Zustand&#xa;• Global State" vertex="1">
          <mxGeometry height="140" width="160" x="690" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-16" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/ui&#xa;&#xa;• Tailwind CSS v4&#xa;• Radix UI&#xa;• Shared Components" vertex="1">
          <mxGeometry height="140" width="160" x="870" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-17" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/api-contracts&#xa;&#xa;• Products API&#xa;• Users API&#xa;• Types" vertex="1">
          <mxGeometry height="140" width="160" x="1050" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-18" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;verticalAlign=top;fontStyle=1;" value="@repo/ts-config&#xa;&#xa;• Shared TS Config&#xa;• tsconfig.base.json" vertex="1">
          <mxGeometry height="140" width="160" x="1230" y="450" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-19" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;fontStyle=1;verticalAlign=top;" value="Infrastructure &amp; Build Tools" vertex="1">
          <mxGeometry height="180" width="1420" x="100" y="670" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-20" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" value="Turborepo&#xa;&#xa;Monorepo Build&#xa;Orchestration&#xa;Caching" vertex="1">
          <mxGeometry height="100" width="200" x="150" y="720" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-21" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" value="pnpm&#xa;&#xa;Package Manager&#xa;Workspace&#xa;Management" vertex="1">
          <mxGeometry height="100" width="200" x="380" y="720" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-22" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" value="GitHub Actions&#xa;&#xa;CI/CD Pipeline&#xa;Build/Test/Deploy" vertex="1">
          <mxGeometry height="100" width="200" x="610" y="720" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-23" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" value="Vercel&#xa;&#xa;Deployment&#xa;Platform&#xa;Hosting" vertex="1">
          <mxGeometry height="100" width="200" x="840" y="720" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-24" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" value="Module Federation&#xa;&#xa;@module-federation/vite&#xa;Runtime Loading" vertex="1">
          <mxGeometry height="100" width="200" x="1070" y="720" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-25" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" value="NextAuth.js v5&#xa;&#xa;Authentication&#xa;Session Management" vertex="1">
          <mxGeometry height="100" width="200" x="1300" y="720" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-26" parent="1" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontSize=11;fontColor=#333333;fontStyle=2;" value="Tech Stack: React 19 • Next.js 15 • Vite 6 • TypeScript 5.7 • Tailwind CSS 4 • Zustand 5 • pnpm 9.4" vertex="1">
          <mxGeometry height="40" width="1400" x="100" y="870" as="geometry" />
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-27" edge="1" parent="1" source="Gh0TvuNcwp4bNjTFrqR8-4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="Gh0TvuNcwp4bNjTFrqR8-13" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="700" y="500" as="sourcePoint" />
            <mxPoint x="750" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Gh0TvuNcwp4bNjTFrqR8-28" edge="1" parent="1" source="Gh0TvuNcwp4bNjTFrqR8-6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#666666;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="Gh0TvuNcwp4bNjTFrqR8-15" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="700" y="500" as="sourcePoint" />
            <mxPoint x="750" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="2. Module Federation Flow" id="bJB6gfLbS8ti63HaCqtc">
    <mxGraphModel dx="1468" dy="967" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title-mf" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#1a1a1a;" value="Module Federation Runtime Loading Flow" vertex="1">
          <mxGeometry height="50" width="800" x="400" y="30" as="geometry" />
        </mxCell>
        <mxCell id="admin-shell-mf" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1;verticalAlign=top;" value="Admin Shell (Host)&#xa;&#xa;module-federation-loader.ts" vertex="1">
          <mxGeometry height="820" width="350" x="100" y="130" as="geometry" />
        </mxCell>
        <mxCell id="step1" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" value="1. Initialize Federation Runtime&#xa;&#xa;initFederationRuntime()&#xa;• Setup __federation_shared__&#xa;• Share React/ReactDOM singletons&#xa;• Setup webpack share scopes" vertex="1">
          <mxGeometry height="100" width="290" x="130" y="200" as="geometry" />
        </mxCell>
        <mxCell id="step2" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" value="2. Remote Configuration&#xa;&#xa;remoteConfigs = {&#xa;  users: { url, scope, module, cssUrl },&#xa;  products: { url, scope, module, cssUrl }&#xa;}" vertex="1">
          <mxGeometry height="90" width="290" x="130" y="320" as="geometry" />
        </mxCell>
        <mxCell id="step3" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" value="3. Load Remote Component&#xa;&#xa;loadRemoteComponent(&#39;users&#39;)&#xa;• Check cache&#xa;• Load CSS if needed&#xa;• Dynamic import remoteEntry.js" vertex="1">
          <mxGeometry height="100" width="290" x="130" y="430" as="geometry" />
        </mxCell>
        <mxCell id="step4" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" value="4. Initialize Remote Container&#xa;&#xa;ensureRemoteContainerInitialized()&#xa;• Call container.init(shareScope)&#xa;• Share dependencies&#xa;• Handle TLA (__tla promise)" vertex="1">
          <mxGeometry height="100" width="290" x="130" y="550" as="geometry" />
        </mxCell>
        <mxCell id="step5" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" value="5. Get Module from Container&#xa;&#xa;container.get(&#39;./app&#39;)&#xa;• Get factory function&#xa;• Execute factory&#xa;• Return module" vertex="1">
          <mxGeometry height="100" width="290" x="130" y="670" as="geometry" />
        </mxCell>
        <mxCell id="step6" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;verticalAlign=top;" value="6. Error Handling &amp; Retry&#xa;&#xa;• Dev mode: Retry with cache-bust&#xa;• Exponential backoff (3 retries)&#xa;• Handle &#39;Please call init first&#39; error&#xa;• Fallback UI" vertex="1">
          <mxGeometry height="120" width="290" x="130" y="790" as="geometry" />
        </mxCell>
        <mxCell id="remotes-container" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;verticalAlign=top;" value="Remote Applications (Vite)" vertex="1">
          <mxGeometry height="820" width="950" x="550" y="130" as="geometry" />
        </mxCell>
        <mxCell id="users-remote-detail" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;verticalAlign=top;align=left;" value="Users Remote (Port 6517)&#xa;&#xa;vite.config.ts Configuration:" vertex="1">
          <mxGeometry height="360" width="400" x="580" y="200" as="geometry" />
        </mxCell>
        <mxCell id="users-config" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;fontFamily=Courier New;" value="federation({&#xa;  name: &#39;users&#39;,&#xa;  manifest: true,&#xa;  filename: &#39;remoteEntry.js&#39;,&#xa;  exposes: {&#xa;    &#39;./app&#39;: &#39;./src/App.tsx&#39;&#xa;  },&#xa;  shared: {&#xa;    react: { singleton: true },&#xa;    &#39;react-dom&#39;: { singleton: true },&#xa;    &#39;@repo/ui&#39;: { singleton: true },&#xa;    &#39;@repo/stores&#39;: { singleton: true }&#xa;  }&#xa;})" vertex="1">
          <mxGeometry height="270" width="360" x="600" y="250" as="geometry" />
        </mxCell>
        <mxCell id="products-remote-detail" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;verticalAlign=top;align=left;" value="Products Remote (Port 3529)&#xa;&#xa;vite.config.ts Configuration:" vertex="1">
          <mxGeometry height="360" width="400" x="1020" y="200" as="geometry" />
        </mxCell>
        <mxCell id="products-config" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;align=left;verticalAlign=top;fontFamily=Courier New;" value="federation({&#xa;  name: &#39;products&#39;,&#xa;  manifest: true,&#xa;  filename: &#39;remoteEntry.js&#39;,&#xa;  exposes: {&#xa;    &#39;./app&#39;: &#39;./src/App.tsx&#39;&#xa;  },&#xa;  shared: {&#xa;    react: { singleton: true },&#xa;    &#39;react-dom&#39;: { singleton: true },&#xa;    &#39;@repo/ui&#39;: { singleton: true },&#xa;    &#39;@repo/stores&#39;: { singleton: true }&#xa;  }&#xa;})" vertex="1">
          <mxGeometry height="270" width="360" x="1040" y="250" as="geometry" />
        </mxCell>
        <mxCell id="urls" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;verticalAlign=top;" value="Remote URLs&#xa;&#xa;Development:&#xa;• users: http://localhost:6517/_users/remoteEntry.js&#xa;• products: http://localhost:3529/_products/remoteEntry.js&#xa;&#xa;Production:&#xa;• users: https://users-remote.example.com/_users/remoteEntry.js&#xa;• products: https://products-remote.example.com/_products/remoteEntry.js" vertex="1">
          <mxGeometry height="150" width="840" x="580" y="600" as="geometry" />
        </mxCell>
        <mxCell id="features" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" value="Key Features&#xa;&#xa;✓ Runtime Loading (No webpack plugin in Next.js)&#xa;✓ Turbopack Compatible&#xa;✓ Singleton Sharing (React, ReactDOM, UI, Stores)&#xa;✓ CSS Loading (Production only)&#xa;✓ Dev Cache-Busting&#xa;✓ Error Recovery with Exponential Backoff&#xa;✓ TLA Support (Top-Level Await)" vertex="1">
          <mxGeometry height="150" width="840" x="580" y="780" as="geometry" />
        </mxCell>
        <mxCell id="arrow1" edge="1" parent="1" source="step3" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#0000FF;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="users-remote-detail" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="700" y="600" as="sourcePoint" />
            <mxPoint x="750" y="550" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow-label1" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontColor=#0000FF;" value="Load remoteEntry.js" vertex="1">
          <mxGeometry height="30" width="120" x="440" y="450" as="geometry" />
        </mxCell>
        <mxCell id="arrow2" edge="1" parent="1" source="step4" style="endArrow=classic;html=1;rounded=0;strokeWidth=3;strokeColor=#0000FF;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" target="products-remote-detail" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="700" y="600" as="sourcePoint" />
            <mxPoint x="750" y="550" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="3. Authentication Flow" id="ZfzOnBRopFkOVPcSTwPZ">
    <mxGraphModel dx="1175" dy="773" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title-auth" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#1a1a1a;" value="Authentication &amp; Authorization Flow (NextAuth.js v5)" vertex="1">
          <mxGeometry height="50" width="1000" x="300" y="30" as="geometry" />
        </mxCell>
        <mxCell id="user" parent="1" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="User" vertex="1">
          <mxGeometry height="120" width="60" x="100" y="150" as="geometry" />
        </mxCell>
        <mxCell id="login-step" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;" value="1. User visits /login" vertex="1">
          <mxGeometry height="60" width="200" x="250" y="180" as="geometry" />
        </mxCell>
        <mxCell id="arrow-user-login" edge="1" parent="1" source="user" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="login-step" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="submit-step" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;" value="2. Submit Credentials&#xa;(email + password)" vertex="1">
          <mxGeometry height="60" width="200" x="520" y="180" as="geometry" />
        </mxCell>
        <mxCell id="arrow-login-submit" edge="1" parent="1" source="login-step" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="submit-step" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="authorize-step" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1;verticalAlign=top;" value="3. NextAuth.js authorize()&#xa;&#xa;Credentials Provider&#xa;@repo/auth-next" vertex="1">
          <mxGeometry height="120" width="250" x="790" y="150" as="geometry" />
        </mxCell>
        <mxCell id="arrow-submit-auth" edge="1" parent="1" source="submit-step" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="authorize-step" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="validate-step" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;verticalAlign=top;" value="4. validateCredentials()&#xa;&#xa;Mock Auth (Development)&#xa;• Admin: full permissions&#xa;• Manager: partial permissions&#xa;• Viewer: read-only" vertex="1">
          <mxGeometry height="120" width="250" x="1110" y="150" as="geometry" />
        </mxCell>
        <mxCell id="arrow-auth-validate" edge="1" parent="1" source="authorize-step" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="validate-step" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="jwt-callback" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;verticalAlign=top;" value="5. JWT Callback&#xa;&#xa;jwtCallback()&#xa;• Add user data to token&#xa;• roles: [&#39;admin&#39;, &#39;manager&#39;]&#xa;• permissions: Permission[]" vertex="1">
          <mxGeometry height="120" width="250" x="1110" y="320" as="geometry" />
        </mxCell>
        <mxCell id="arrow-validate-jwt" edge="1" parent="1" source="validate-step" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="jwt-callback" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="session-callback" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;verticalAlign=top;" value="6. Session Callback&#xa;&#xa;sessionCallback()&#xa;• Decode token&#xa;• Populate session.user&#xa;• Add permissions to session" vertex="1">
          <mxGeometry height="120" width="250" x="790" y="320" as="geometry" />
        </mxCell>
        <mxCell id="arrow-jwt-session" edge="1" parent="1" source="jwt-callback" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" target="session-callback" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="middleware" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;verticalAlign=top;" value="7. Middleware (Admin Shell)&#xa;&#xa;middleware.ts&#xa;• Check session&#xa;• Route-based permissions&#xa;  /admin/users → user:read&#xa;  /admin/products → product:read&#xa;• Redirect to /unauthorized if denied" vertex="1">
          <mxGeometry height="180" width="200" x="520" y="320" as="geometry" />
        </mxCell>
        <mxCell id="arrow-session-middleware" edge="1" parent="1" source="session-callback" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" target="middleware" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="rbac-check" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;verticalAlign=top;" value="8. RBAC Check&#xa;&#xa;@repo/rbac&#xa;canWithPermissions()&#xa;• Check required permission&#xa;• Match against user permissions&#xa;• Allow/Deny access" vertex="1">
          <mxGeometry height="180" width="200" x="250" y="320" as="geometry" />
        </mxCell>
        <mxCell id="arrow-middleware-rbac" edge="1" parent="1" source="middleware" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#000000;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" target="rbac-check" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="grant-access" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;" value="9. Access Granted&#xa;&#xa;Redirect to protected route&#xa;Load remote modules" vertex="1">
          <mxGeometry height="80" width="200" x="250" y="550" as="geometry" />
        </mxCell>
        <mxCell id="arrow-rbac-grant" edge="1" parent="1" source="rbac-check" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#00FF00;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="grant-access" value="✓ Authorized">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="deny-access" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;fontStyle=1;" value="10. Access Denied&#xa;&#xa;Redirect to /unauthorized" vertex="1">
          <mxGeometry height="80" width="200" x="520" y="550" as="geometry" />
        </mxCell>
        <mxCell id="arrow-rbac-deny" edge="1" parent="1" source="rbac-check" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#FF0000;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;dashed=1;" target="deny-access" value="✗ Unauthorized">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="permissions-table" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;verticalAlign=top;" value="Permission Model&#xa;&#xa;Roles:&#xa;• admin: [&#39;admin&#39;, &#39;manager&#39;]&#xa;• manager: [&#39;manager&#39;]&#xa;• viewer: [&#39;viewer&#39;]&#xa;&#xa;Permissions:&#xa;• admin:access - Admin panel access&#xa;• user:read - View users&#xa;• user:write - Modify users&#xa;• product:read - View products&#xa;• product:write - Modify products" vertex="1">
          <mxGeometry height="200" width="570" x="790" y="490" as="geometry" />
        </mxCell>
        <mxCell id="session-storage" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;fontFamily=Courier New;" value="Session Storage&#xa;&#xa;Strategy: JWT&#xa;Max Age: 30 days&#xa;Update Age: 24 hours&#xa;Secure Cookies: Production only&#xa;&#xa;Session Object:&#xa;{&#xa;  user: {&#xa;    id, email, name,&#xa;    roles: string[],&#xa;    permissions: Permission[]&#xa;  },&#xa;  expires: string&#xa;}" vertex="1">
          <mxGeometry height="200" width="620" x="100" y="730" as="geometry" />
        </mxCell>
        <mxCell id="env-vars" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;fontFamily=Courier New;" value="Environment Variables&#xa;&#xa;NEXTAUTH_URL: Base URL for callbacks&#xa;NEXTAUTH_SECRET: JWT signing key&#xa;&#xa;Generate secret:&#xa;openssl rand -base64 32" vertex="1">
          <mxGeometry height="200" width="570" x="790" y="730" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="4. State Management" id="2Enrtkl3apefO0tcmOrO">
    <mxGraphModel dx="881" dy="580" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title-state" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=28;fontStyle=1;fontColor=#1a1a1a;" value="Global State Management (Zustand)" vertex="1">
          <mxGeometry height="50" width="800" x="400" y="30" as="geometry" />
        </mxCell>
        <mxCell id="shell-store-package" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=18;fontStyle=1;verticalAlign=top;" value="@repo/stores" vertex="1">
          <mxGeometry height="800" width="1400" x="100" y="120" as="geometry" />
        </mxCell>
        <mxCell id="store-structure" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;verticalAlign=top;align=left;" value="Shell Store Structure" vertex="1">
          <mxGeometry height="710" width="600" x="150" y="180" as="geometry" />
        </mxCell>
        <mxCell id="auth-state" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=top;fontFamily=Courier New;" value="Auth State&#xa;&#xa;auth: {&#xa;  session: Session | null&#xa;}&#xa;&#xa;Actions:&#xa;• setSession(session: Session)" vertex="1">
          <mxGeometry height="130" width="540" x="180" y="230" as="geometry" />
        </mxCell>
        <mxCell id="tenant-state" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=top;fontFamily=Courier New;" value="Tenant State&#xa;&#xa;tenant: {&#xa;  tenantId: string | null&#xa;}&#xa;&#xa;Actions:&#xa;• setTenantId(tenantId: string)" vertex="1">
          <mxGeometry height="130" width="540" x="180" y="380" as="geometry" />
        </mxCell>
        <mxCell id="ui-state" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=top;fontFamily=Courier New;" value="UI State&#xa;&#xa;ui: {&#xa;  notifications: Notification[]&#xa;}&#xa;&#xa;Actions:&#xa;• addNotification(notification)&#xa;• clearNotifications()&#xa;• markNotificationRead(id)&#xa;• removeNotification(id)" vertex="1">
          <mxGeometry height="150" width="540" x="180" y="530" as="geometry" />
        </mxCell>
        <mxCell id="remotes-state" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=top;fontFamily=Courier New;" value="Remotes State (Loading Status)&#xa;&#xa;remotes: {&#xa;  users: { loaded, loading, error },&#xa;  products: { loaded, loading, error }&#xa;}&#xa;&#xa;Actions:&#xa;• setRemoteLoading(name, loading)&#xa;• setRemoteLoaded(name, loaded)&#xa;• setRemoteError(name, error)" vertex="1">
          <mxGeometry height="150" width="540" x="180" y="700" as="geometry" />
        </mxCell>
        <mxCell id="store-impl" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=14;fontStyle=1;verticalAlign=top;align=left;" value="Store Implementation" vertex="1">
          <mxGeometry height="680" width="650" x="800" y="180" as="geometry" />
        </mxCell>
        <mxCell id="singleton" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;verticalAlign=top;fontFamily=Courier New;" value="Singleton Pattern&#xa;&#xa;const STORE_KEY = &#39;__SHELL_STORE__&#39;;&#xa;&#xa;Store attached to global scope:&#xa;• globalThis.__SHELL_STORE__&#xa;• window.__SHELL_STORE__&#xa;&#xa;Ensures single source of truth across:&#xa;• Shell application&#xa;• Remote modules&#xa;• Shared packages" vertex="1">
          <mxGeometry height="180" width="590" x="830" y="230" as="geometry" />
        </mxCell>
        <mxCell id="init-func" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;verticalAlign=top;fontFamily=Courier New;" value="Initialization&#xa;&#xa;initShellStore(initialState?)&#xa;• Check if store exists&#xa;• Create new store if needed&#xa;• Attach to global scope&#xa;• Return store instance&#xa;&#xa;getShellStore()&#xa;• Retrieve existing store&#xa;• Auto-initialize if not found&#xa;• Return store instance" vertex="1">
          <mxGeometry height="190" width="590" x="830" y="430" as="geometry" />
        </mxCell>
        <mxCell id="usage" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;align=left;verticalAlign=top;fontFamily=Courier New;" value="Usage in React Components&#xa;&#xa;import { useShellStore } from &#39;@repo/stores&#39;;&#xa;&#xa;function MyComponent() {&#xa;  const session = useShellStore(s =&gt; s.auth.session);&#xa;  const setSession = useShellStore(s =&gt; s.setSession);&#xa;  const notifications = useShellStore(s =&gt; s.ui.notifications);&#xa;  &#xa;  // Use state and actions...&#xa;}&#xa;&#xa;Usage in Remotes:&#xa;• Same API as shell&#xa;• Shared singleton instance&#xa;• Real-time synchronization" vertex="1">
          <mxGeometry height="200" width="590" x="830" y="640" as="geometry" />
        </mxCell>
        <mxCell id="state-features" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;align=left;verticalAlign=top;" value="Key Features&#xa;&#xa;✓ Singleton Pattern (Global State)&#xa;✓ Zustand (Vanilla Store)&#xa;✓ TypeScript Typed&#xa;✓ Cross-Module Sharing&#xa;✓ Notification System&#xa;✓ Remote Loading Status&#xa;✓ Simple API (No Providers)&#xa;✓ React Hooks Integration" vertex="1">
          <mxGeometry height="160" width="1300" x="150" y="950" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
